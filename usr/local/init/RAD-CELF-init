#Setup the Clocks

echo DEBUGS OFF
echo 9 >/proc/sys/kernel/printk
echo file spi-cadence.c -p >/dev/ddc

#Reset the entire clock chain

set.clkdA CSPD 		00
set.clkdA UPDATE 	01


# Set Primary Clock LVPECL 2 Off, set LVDS 3 to Off, Set LVDS 4 to TTL
set.clkdA LVPECL2 	0a
set.clkdA LVDS3 	01
set.clkdA LVDS4 	08
set.clkdA UPDATE	01

# Set Secondary Clock LV$PECL 2 Off, set LVDS 3 to TTL
set.clkdB LVPECL2	0a
set.clkdB LVDS3		08
set.clkdB UPDATE	01


#Set all the AD9512 dividers to divide by 5 to avoid overheat

set.clkdA	DIV0	1200
set.clkdA	DIV1	1200
set.clkdA	DIV2	1200
set.clkdA	DIV3	1200
set.clkdA	DIV4	1200
set.clkdA	UPDATE	1

set.clkdB	DIV0	0080
set.clkdB	DIV1	0080
set.clkdB	DIV2	0080
set.clkdB	DIV3	0080
set.clkdB	DIV4	0080
set.clkdB	UPDATE	1



# Reset the DDS
set.site 2 ddsX_hard_reset=1
set.site 2 ddsX_hard_reset=0

#Switch the clocks off on the DDS Devices to stop I/O Updates

#Clock Remapping DDS - Device clkA Output 1
set.clkdA	LVPECL1	0a
set.clkdA	UPDATE	01

#The two Main DDS devices on device clkB Outputs 0 and 1
set.clkdB	LVPECL0	0a
set.clkdB	LVPECL1	0a
set.clkdB	UPDATE	1

#Write to the Control Registers on the 3 DDS devices - External I/O Update and SDO On
# Set the RefClk Multiplier on at x4 switch off the Inverse Sinc Filter

set.ddsA	CR	00400041
set.ddsB	CR	00400041
set.ddsC	CR	00400041


#Switch the Clocks back on again
set.clkdA	LVPECL1	08
set.clkdA	LVPECL0 08
set.clkdB	LVPECL1	08
set.clkdB	LVPECL0 08
set.clkdA	UPDATE	1
set.clkdB	UPDATE	1

# tell FPGA to take over the clocking

set.site 2 ddsA_upd_clk_fpga	1
set.site 2 ddsB_upd_clk_fpga	1
set.site 2 ddsC_upd_clk_fpga	1

set.ddsA strobe_mode 1
set.ddsB strobe_mode 1
set.ddsC strobe_mode 1


